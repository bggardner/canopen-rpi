import datetime


BROADCAST_NODE_ID = 0

# Function codes
FUNCTION_CODE_BITNUM = 7
FUNCTION_CODE_MASK = 0x780
FUNCTION_CODE_NMT = 0x0
FUNCTION_CODE_SYNC = 0x1
FUNCTION_CODE_EMCY = 0x1
FUNCTION_CODE_TIME_STAMP = 0x2
FUNCTION_CODE_TPDO1 = 0x3
FUNCTION_CODE_RPDO1 = 0x4
FUNCTION_CODE_TPDO2 = 0x5
FUNCTION_CODE_RPDO2 = 0x6
FUNCTION_CODE_TPDO3 = 0x7
FUNCTION_CODE_RPDO3 = 0x8
FUNCTION_CODE_TPDO4 = 0x9
FUNCTION_CODE_RPDO4 = 0xA
FUNCTION_CODE_SDO_TX = 0xB
FUNCTION_CODE_SDO_RX = 0xC
FUNCTION_CODE_NMT_ERROR_CONTROL = 0xE

# NMT commands
NMT_NODE_CONTROL = 0
NMT_NODE_CONTROL_START = 1
NMT_NODE_CONTROL_STOP = 2
NMT_NODE_CONTROL_PREOPERATIONAL = 128
NMT_NODE_CONTROL_RESET_NODE = 129
NMT_NODE_CONTROL_RESET_COMMUNICATION = 130
NMT_GFC = 1
NMT_MASTER_NODE_ID = 0x71
NMT_FLYING_MASTER_REQUEST = 0x72
NMT_ACTIVE_MASTER_REQUEST = 0x73
NMT_MASTER_RESPONSE = 0x74
NMT_MASTER_REQUEST = 0x75
NMT_FORCE_FLYING_MASTER = 0x76
NMT_INDICATE_ACTIVE_INTERFACE = 0x7F

# NMT states
NMT_STATE_INITIALISATION = 0
NMT_STATE_STOPPED = 4
NMT_STATE_OPERATIONAL = 5
NMT_STATE_PREOPERATIONAL = 127

# Emergency error codes
EMCY_RESET = 0x0000
EMCY_NONE = 0x0000
EMCY_GENERIC = 0x1000
EMCY_HEARTBEAT_BY_NODE = 0x8F00

# Object dictionary structure
OD_STRUCTURE_OBJECT_TYPE_BITNUM = 0
OD_STRUCTURE_DATA_TYPE_BITNUM = 8

# Object dictionary object type
OD_OBJECT_TYPE_NULL = 0
OD_OBJECT_TYPE_DOMAIN = 2
OD_OBJECT_TYPE_DEFTYPE = 5
OD_OBJECT_TYPE_DEFSTRUCT = 6
OD_OBJECT_TYPE_VAR = 7
OD_OBJECT_TYPE_ARRAY = 8
OD_OBJECT_TYPE_RECORD = 9

# Object dictionary indices and sub-indices
ODSI_VALUE = 0x00
ODSI_STRUCTURE = 0xFF
ODI_DATA_TYPE_BOOLEAN = 0x0001
ODI_DATA_TYPE_INTEGER8 = 0x0002
ODI_DATA_TYPE_INTEGER16 = 0x0003
ODI_DATA_TYPE_INTEGER32 = 0x0004
ODI_DATA_TYPE_UNSIGNED8 = 0x0005
ODI_DATA_TYPE_UNSIGNED16 = 0x0006
ODI_DATA_TYPE_UNSIGNED32 = 0x0007
ODI_DATA_TYPE_REAL32 = 0x0008
ODI_DATA_TYPE_VISIBLE_STRING = 0x0009
ODI_DATA_TYPE_OCTET_STRING = 0x000A
ODI_DATA_TYPE_UNICODE_STRING = 0x000B
ODI_DATA_TYPE_TIME_OF_DAY = 0x000C
ODI_DATA_TYPE_TIME_DIFFERENCE = 0x000D
ODI_DATA_TYPE_DOMAIN = 0x000E
ODI_DATA_TYPE_INTEGER24 = 0x0010
ODI_DATA_TYPE_REAL64 = 0x0011
ODI_DATA_TYPE_INTEGER40 = 0x0012
ODI_DATA_TYPE_INTEGER48 = 0x0013
ODI_DATA_TYPE_INTEGER56 = 0x0014
ODI_DATA_TYPE_INTEGER64 = 0x0015
ODI_DATA_TYPE_UNSIGNED24 = 0x0016
ODI_DATA_TYPE_UNSIGNED40 = 0x0018
ODI_DATA_TYPE_UNSIGNED48 = 0x0019
ODI_DATA_TYPE_UNSIGNED56 = 0x001A
ODI_DATA_TYPE_UNSIGNED64 = 0x001B
ODI_DATA_TYPE_PDO_COMMUNICATION_PARAMETER = 0x0020
ODSI_DATA_TYPE_PDO_COMM_PARAM_ID = 0x01
ODSI_DATA_TYPE_PDO_COMM_PARAM_TYPE = 0x02
ODSI_DATA_TYPE_PDO_COMM_PARAM_INHIBIT_TIME = 0x03
ODSI_DATA_TYPE_PDO_COMM_PARAM_EVENT_TIMER = 0x05
ODSI_DATA_TYPE_PDO_COMM_PARAM_SYNC_START = 0x06
ODI_DATA_TYPE_PDO_MAPPING_PARAMETER = 0x0021
ODI_DATA_TYPE_SDO_PARAMETER = 0x0022
ODSI_DATA_TYPE_SDO_PARAM_CSID = 0x01
ODSI_DATA_TYPE_SDO_PARAM_SCID = 0x02
ODSI_DATA_TYPE_SDO_PARAM_NODE_ID = 0x03
ODI_DATA_TYPE_IDENTITY = 0x0023
ODSI_DATA_TYPE_IDENTITY_VENDOR = 0x01
ODSI_DATA_TYPE_IDENTITY_PRODUCT = 0x02
ODSI_DATA_TYPE_IDENTITY_REVISION = 0x03
ODSI_DATA_TYPE_IDENTITY_SERIAL = 0x04
ODI_DEVICE_TYPE = 0x1000
ODI_ERROR = 0x1001
ODI_PREDEFINED_ERROR_FIELD = 0x1003
ODI_SYNC = 0x1005
ODI_SYNC_TIME = 0x1006
ODI_TIME_STAMP = 0x1012
ODI_HIGH_RESOLUTION_TIME_STAMP = 0x1013
ODI_EMCY_ID = 0x1014
ODI_INHIBIT_TIME_EMCY = 0x1015
ODI_HEARTBEAT_CONSUMER_TIME = 0x1016
ODSI_HEARTBEAT_CONSUMER_TIME = 0x01
ODI_HEARTBEAT_PRODUCER_TIME = 0x1017
ODI_IDENTITY = 0x1018
ODSI_IDENTITY_VENDOR = 0x01
ODSI_IDENTITY_PRODUCT = 0x02
ODSI_IDENTITY_REVISION = 0x03
ODSI_IDENTITY_SERIAL = 0x04
ODI_SYNCHRONOUS_COUNTER_OVERFLOW_VALUE = 0x1019
ODI_STORE_EDS = 0x1021
ODI_STORE_FORMAT = 0x1022
ODI_ERROR_BEHAVIOR = 0x1029
ODI_NMT_INHIBIT_TIME = 0x102A
ODI_SDO_SERVER = 0x1200
ODSI_SDO_SERVER_DEFAULT_CSID = 0x01
ODSI_SDO_SERVER_DEFAULT_SCID = 0x02
ODI_SDO_CLIENT = 0x1280
ODSI_SDO_CLIENT_TX = 0x01
ODSI_SDO_CLIENT_RX = 0x02
ODSI_SDO_CLIENT_NODE_ID = 0x03
ODI_TPDO1_COMMUNICATION_PARAMETER = 0x1800
ODSI_TPDO_COMM_PARAM_ID = 0x01
ODSI_TPDO_COMM_PARAM_TYPE = 0x02
ODSI_TPDO_COMM_PARAM_INHIBIT_TIME = 0x03
ODI_TPDO1_MAPPING_PARAMETER = 0x1A00
ODI_STORE_DCF = 0x1F20
ODI_STORE_FORMAT = 0x1F21
ODI_CONCISE_DCF = 0x1F22
ODI_STORE_EDS_NMT_SLAVE = 0x1F23
ODI_STORE_FORMAT_EDS_NMT_SLAVE = 0x1F24
ODI_CONFIGURATION_REQUEST = 0x1F25
ODI_EXPECTED_CONFIGURATION_DATE = 0x1F26
ODI_EXPECTED_CONFIGURATION_TIME = 0x1F27
ODI_PROGRAM_DATA_DEVICE = 0x1F50
ODI_PROGRAM_CONTROL = 0x1F51
ODI_EXPECTED_SOFTWARE_IDENTIFICATION = 0x1F55
ODI_PROGRAM_SOFTWARE_IDENTIFICATION = 0x1F56
ODI_FLASH_STATUS_IDENTIFICATION = 0x1F57
ODI_PROGRAM_DATA_MANAGER = 0x1F58
ODI_REDUNDANCY_CONFIGURATION = 0x1F60
ODSI_REDUNDANCY_CONFIG_MAX_TX_DELAY_TIME = 0x01
ODSI_REDUNDANCY_CONFIG_HB_EVAL_TIME_POWER_ON = 0x02
ODSI_REDUNDANCY_CONFIG_HB_EVAL_TIME_RESET_COMM = 0x03
ODSI_REDUNDANCY_CONFIG_CHAN_ERR_CNT_THRESHOLD = 0x04
ODSI_REDUNDANCY_CONFIG_CHAN_ERR_CNT = 0x05
ODI_NMT_STARTUP = 0x1F80
ODI_NMT_SLAVE_ASSIGNMENT = 0x1F81
ODI_REQUEST_NMT = 0x1F82
ODI_REQUEST_NODE_GUARDING = 0x1F83
ODI_DEVICE_TYPE_IDENTIFICATION = 0x1F84
ODI_VENDOR_IDENTIFICATION = 0x1F85
ODI_PRODUCT_CODE = 0x1F86
ODI_REVISION_NUMBER = 0x1F87
ODI_SERIAL_NUMBER = 0x1F88
ODI_BOOT_TIME = 0x1F89
ODI_RESTORE_CONFIGURATION = 0x1F8A
ODI_NMT_FLYING_MASTER_TIMING_PARAMETERS = 0x1F90
ODSI_NMT_FLYING_MASTER_TIMING_PARAMS_TIMEOUT = 0x01
ODSI_NMT_FLYING_MASTER_TIMING_PARAMS_DELAY = 0x02
ODSI_NMT_FLYING_MASTER_TIMING_PARAMS_PRIORITY = 0x03
ODSI_NMT_FLYING_MASTER_TIMING_PARAMS_PRIORITY_TIME_SLOT = 0x04
ODSI_NMT_FLYING_MASTER_TIMING_PARAMS_DEVICE_TIME_SLOT = 0x05
ODSI_NMT_FLYING_MASTER_TIMING_PARAMS_DETECT_TIME = 0x06
ODI_SELF_STARTING_NODES_TIMING_PARAMETERS = 0x1F91
ODSI_SELF_STARTING_NODES_TIMING_PARAMS_TIMEOUT = 0x01
ODSI_SELF_STARTING_NODES_TIMING_PARAMS_DELAY = 0x02
ODSI_SELF_STARTING_NODES_TIMING_PARAMS_TIME_SLOT = 0x03

# TIME
EPOCH = datetime.datetime(1984, 1, 1, tzinfo=datetime.timezone.utc)

# SDO
SDO_INITIATE_N_BITNUM = 2
SDO_INITIATE_N_MASK = 0xC
SDO_SEGMENT_N_BITNUM = 1
SDO_SEGMENT_N_MASK = 0xE
SDO_E_BITNUM = 1
SDO_S_BITNUM = 0
SDO_CS_BITNUM = 5
SDO_CS_MASK = 0xE0
SDO_T_BITNUM = 4
SDO_C_BITNUM = 0
SDO_CCS_DOWNLOAD_SEGMENT = 0
SDO_CCS_DOWNLOAD_INITIATE = 1
SDO_CCS_UPLOAD_INITIATE = 2
SDO_CCS_UPLOAD_SEGMENT = 3
SDO_CCS_BLOCK_UPLOAD = 5
SDO_CCS_BLOCK_DOWNLOAD = 6
SDO_SCS_UPLOAD_SEGMENT = 0
SDO_SCS_DOWNLOAD_SEGMENT = 1
SDO_SCS_UPLOAD_INITIATE = 2
SDO_SCS_DOWNLOAD_INITIATE = 3
SDO_SCS_BLOCK_DOWNLOAD = 5
SDO_SCS_BLOCK_UPLOAD = 6
SDO_CS_ABORT = 4
SDO_ABORT_TOGGLE = 0x05030000
SDO_ABORT_INVALID_CS = 0x05040001
SDO_ABORT_INVALID_BLKSIZE = 0x05040002
SDO_ABORT_INVALID_SEQNO = 0x05040003
SDO_ABORT_CRC_ERROR = 0x05040004
SDO_ABORT_WO = 0x06010001
SDO_ABORT_RO = 0x06010002
SDO_ABORT_OBJECT_DNE = 0x06020000
SDO_ABORT_PARAMETER_LENGTH = 0x06070010
SDO_ABORT_SUBINDEX_DNE = 0x06090011
SOD_ABORT_INVALID_VALUE = 0x06090030
SDO_ABORT_GENERAL = 0x08000000
SDO_ABORT_NO_DATA = 0x08000024
SDO_BLOCK_SUBCOMMAND_INITIATE = 0
SDO_BLOCK_SUBCOMMAND_END = 1
SDO_BLOCK_SUBCOMMAND_RESPONSE = 2
SDO_BLOCK_SUBCOMMAND_START = 3

# PDO
TPDO_COMM_PARAM_ID_VALID_BITNUM = 31
TPDO_COMM_PARAM_ID_RTR_BITNUM = 30
